# Tracer

Рендерер, работающий методом трассировки оптических лучей, для отрисовки 3D-сцен с реалистичными отражениями. Цвет каждого пикселя изображения определяется траекторией луча, выпущенного сквозь пиксель матрицы виртуальной камеры, положением источников света и тел в сцене, а также их материалами.
:
Пример работы рендерера:
![Screenshot](https://sun9-43.userapi.com/impf/j5lbMAVGze14OxlmDNnwHczhlSSNyyi2eoBBag/jteLPBGKCxI.jpg?size=800x600&quality=96&sign=dd1d7147f30357ab4cc4872968888bf9&type=album)

## Основные элементы

Основу модуля составляют арифметические классы, используемые для описания пространственной геометрии сцены и лучей. Реализованы с помощью массивов и веторных функций NumPy для повышения производительности.

### Арифметические классы

- Vec4 -- четырёхмерные векторы (x, y, z, w) для точек и направлений в пространстве
- Mat4 -- матрицы 4х4 для линейных трансформаций пространств и объектов
-- Translator -- параллельный перенос
-- Rotor -- поворот вокруг основных осей
-- Scaler -- масштабирование по осям

### Трассировка

- Ray -- лучи -- пары (источник, направление)
- Intersection -- структуры, описывающие пересечение луча с объектом

### Объекты сцены

- PointSource -- точечные источники света
- Eye -- перспективные камеры
- Triangle, Quad, Sphere, Box -- примитивные тела

## Принцип работы

Виртуальная камера последовательно выпускает в сцену лучи сквозь виртуальную оптическую матрицу, определяемую необходимым разрешением изображения и аргументом поля обзора.

![Eye code](https://sun9-60.userapi.com/impf/8GczIB-oEpYYxK41n3k70qSiZGH-XQGxo3-yHg/Dl6M7OCw-rY.jpg?size=910x731&quality=96&sign=78d990195da1643963180b1b315e9cfb&type=album)

Каждый луч, выпущенный из камеры, проверяется на пересечение каждым телом в сцене. Каждый класс примитивных тел имеет свою имплементацию метода поиска пересечений.

![Intersection code](https://sun9-22.userapi.com/impf/Xj3ui7aDNYjfAVyh8NvemWbmtVHr4FCGYbOxbw/MZdy3D2q1dM.jpg?size=514x242&quality=96&sign=8d2c031dc55fdafe32f488876789fe51&type=album)
(Приме)

Цвет луча, возвращаемый камере, определяется по [модели отражения Фонга](https://en.wikipedia.org/wiki/Phong_reflection_model). Он зависит от ориентации и цвета поверхности пересеченного тела, а также -- если тело имеет блестящую поверхность -- цветом "отраженного" луча, рекурсивно выпущенного из точки пересечения.

![Phong layers](https://upload.wikimedia.org/wikipedia/commons/6/6b/Phong_components_version_4.png)

Каждый объект тела хранит в себе матрицы для переходов между мировой и локальной системами координат. Расчеты пересечений и отражений на поверхности тела гораздо проще производить в локальной системе координат, в которой тело сонаправлено с осями и имеет типовые размеры и положения точек.

Полученный массив цветовых данных пикселей преобразуется в изображение с помощью функций PIL.
 
## Использованные сторонние модули
 
 - NumPy
 - PIL/Pillow
 
## Источники

 - The Ray Tracer Challenge: A Test-Driven Guide to Your First 3D Renderer, Джемис Бак (2019)
 
Сторонние зависимости указаны в файле requirements.txt.
Версия Python 3.8.5. 
 
 